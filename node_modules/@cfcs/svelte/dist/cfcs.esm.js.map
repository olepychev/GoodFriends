{"version":3,"file":"cfcs.esm.js","sources":["../src/reactive/useReactive.ts"],"sourcesContent":["import { ReactiveSubscribe, ReactiveAdapterParam, camelize, adaptReactive, ReactiveState } from \"@cfcs/core\";\nimport { onDestroy, onMount } from \"svelte/internal\";\nimport { writable, Writable } from \"svelte/store\";\nimport { ReactiveResult, Ref } from \"./types\";\n\n/**\n * @description Instead of `bind:this`, you can bind this via the `use:` directive.\n * @category Common\n * @see Ref\n * @example\n * ```html\n * <script>\n * import { onMount } from \"svelte\";\n * import { useRef } from \"@cfcs/svelte\";\n *\n * const elementRef = useRef();\n *\n * onMount(() => {\n *   console.log(elementRef.current);\n * });\n * </script>\n * <div use:elementRef>Element</div>\n * ```\n */\nexport function useRef<T>(defaultValue?: T): Ref<T> {\n  const refFunction = (value: T) => {\n    refFunction.current = value;\n\n    return {\n      destroy() {\n        return;\n      },\n    };\n  };\n  refFunction.current = defaultValue;\n\n  return refFunction;\n}\n\n/**\n * @description In Svelte, you can create reactive components through adapters.\n * @category Reactive\n * @example\n * ```ts\n * import { useReactive } from \"@cfcs/svelte\";\n *\n * export function useReactiveComponent() {\n *   return useReactive(REACTIVE_ADAPTER);\n * }\n * ```\n */\nexport function useReactive<\n  Instance extends ReactiveSubscribe<Record<string, any>>,\n  State extends Record<string, any> = ReactiveState<Instance>,\n  Methods extends keyof Partial<Instance> = any,\n  Props = any,\n  Events extends Record<string, any> = {},\n>(\n  reactiveAdapter: ReactiveAdapterParam<Instance, State, Methods, Props, Events>,\n  props?: () => Props,\n): ReactiveResult<Instance, State, Methods, Events> {\n  const adaptResult = adaptReactive(reactiveAdapter, props);\n  const reactiveState = adaptResult.state();\n  const writables: Record<string, Writable<any>> = {};\n  const names = Object.keys(reactiveState);\n  const methods = adaptResult.methods();\n\n  for (const name in reactiveState) {\n    writables[name] = writable(reactiveState[name]);\n  }\n\n  onMount(() => {\n    adaptResult.mounted();\n    const inst = adaptResult.instance();\n\n    names.forEach(name => {\n      inst.subscribe(name as any, (value: any) => {\n        writables[name].set(value);\n      });\n    });\n\n    adaptResult.init();\n  });\n\n  onDestroy(() => {\n    adaptResult.destroy();\n  });\n  const reactiveEvents = adaptResult.events();\n  const events = reactiveEvents.reduce((result, name) => {\n    result[camelize(`on ${name as any}`)] = (callback: (...args: any[]) => void) => {\n      adaptResult.on(name as any, callback as any);\n\n      onDestroy(() => {\n        adaptResult.off(name as any, callback as any);\n      });\n    };\n\n    return result;\n  }, {} as Record<string, any>);\n\n  return {\n    ...writables,\n    ...methods,\n    ...events,\n  } as any;\n}\n\n"],"names":["useRef","defaultValue","refFunction","value","current","destroy","useReactive","reactiveAdapter","props","adaptResult","adaptReactive","reactiveState","state","writables","names","Object","keys","methods","name","writable","onMount","mounted","inst","instance","forEach","subscribe","set","init","onDestroy","reactiveEvents","events","reduce","result","camelize","callback","on","off","__assign"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKA;;;;;;;;;;;;;;;;;;;;SAmBgBA,OAAUC;EACxB,IAAMC,WAAW,GAAG,UAACC,KAAD;IAClBD,WAAW,CAACE,OAAZ,GAAsBD,KAAtB;IAEA,OAAO;MACLE,OAAO;QACL;;KAFJ;GAHF;;EASAH,WAAW,CAACE,OAAZ,GAAsBH,YAAtB;EAEA,OAAOC,WAAP;AACD;AAED;;;;;;;;;;;;;SAYgBI,YAOdC,iBACAC;EAEA,IAAMC,WAAW,GAAGC,aAAa,CAACH,eAAD,EAAkBC,KAAlB,CAAjC;EACA,IAAMG,aAAa,GAAGF,WAAW,CAACG,KAAZ,EAAtB;EACA,IAAMC,SAAS,GAAkC,EAAjD;EACA,IAAMC,KAAK,GAAGC,MAAM,CAACC,IAAP,CAAYL,aAAZ,CAAd;EACA,IAAMM,OAAO,GAAGR,WAAW,CAACQ,OAAZ,EAAhB;;EAEA,KAAK,IAAMC,IAAX,IAAmBP,aAAnB,EAAkC;IAChCE,SAAS,CAACK,IAAD,CAAT,GAAkBC,QAAQ,CAACR,aAAa,CAACO,IAAD,CAAd,CAA1B;;;EAGFE,OAAO,CAAC;IACNX,WAAW,CAACY,OAAZ;IACA,IAAMC,IAAI,GAAGb,WAAW,CAACc,QAAZ,EAAb;IAEAT,KAAK,CAACU,OAAN,CAAc,UAAAN,IAAA;MACZI,IAAI,CAACG,SAAL,CAAeP,IAAf,EAA4B,UAACf,KAAD;QAC1BU,SAAS,CAACK,IAAD,CAAT,CAAgBQ,GAAhB,CAAoBvB,KAApB;OADF;KADF;IAMAM,WAAW,CAACkB,IAAZ;GAVK,CAAP;EAaAC,SAAS,CAAC;IACRnB,WAAW,CAACJ,OAAZ;GADO,CAAT;EAGA,IAAMwB,cAAc,GAAGpB,WAAW,CAACqB,MAAZ,EAAvB;EACA,IAAMA,MAAM,GAAGD,cAAc,CAACE,MAAf,CAAsB,UAACC,MAAD,EAASd,IAAT;IACnCc,MAAM,CAACC,QAAQ,CAAC,YAAA,CAAMf,IAAN,CAAD,CAAT,CAAN,GAAwC,UAACgB,QAAD;MACtCzB,WAAW,CAAC0B,EAAZ,CAAejB,IAAf,EAA4BgB,QAA5B;MAEAN,SAAS,CAAC;QACRnB,WAAW,CAAC2B,GAAZ,CAAgBlB,IAAhB,EAA6BgB,QAA7B;OADO,CAAT;KAHF;;IAQA,OAAOF,MAAP;GATa,EAUZ,EAVY,CAAf;EAYA,OAAOK,+BACFxB,YACAI,UACAa,OAHL;AAKD;;;;"}